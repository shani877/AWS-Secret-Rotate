import json
import boto3
import string
import random

# ğŸš€ Lambda entry point
def lambda_handler(event, context):
    
    N = 10  # ğŸ”¢ Length of the new password to generate

    # ğŸ” Generate a random password (uppercase letters + digits)
    newPassword = ''.join(random.choices(string.ascii_uppercase + 
                                         string.digits, k=N))

    # ğŸ§° Initialize AWS Secrets Manager client
    client = boto3.client('secretsmanager')

    # ğŸ“¥ Fetch the current secret value
    getRes = client.get_secret_value(
        SecretId = 'SECRET_NAME'  # ğŸ· Replace with your actual secret name
    )

    # ğŸ“¦ Load the current secrets as a dictionary
    current_secrets = json.loads(getRes['SecretString'])
    
    # ğŸ”„ Update the key with the new password
    current_secrets.update({
        "KEY_TO_ROTATE": newPassword  # ğŸ— Replace it "KEY_TO_ROTATE" with your actual key name
    })
    
    # ğŸ“¤ Push the updated secret back to Secrets Manager
    response = client.put_secret_value(
        SecretId = 'SECRET_NAME',  # ğŸ· Same secret name as above
        SecretString=str(json.dumps(current_secrets))  # ğŸ” Updated secret as JSON string
    )
